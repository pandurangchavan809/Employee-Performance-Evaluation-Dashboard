<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Performance Reports | PerfTrack AI</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --primary: #667eea;
      --secondary: #764ba2;
      --accent-yellow: #fef3c7;
      --text-dark: #1a202c;
      --glass: rgba(255, 255, 255, 0.95);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body { 
      font-family: 'Inter', sans-serif; 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
      min-height: 100vh; 
      color: var(--text-dark); 
      line-height: 1.6;
    }

    /* Header & Navigation */
    header { 
      background: var(--glass); 
      backdrop-filter: blur(12px); 
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1); 
      position: sticky; 
      top: 0; 
      z-index: 1000; 
    }
    .header-content { max-width: 1400px; margin: 0 auto; padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; }
    .logo { display: flex; align-items: center; gap: 0.75rem; font-size: 1.5rem; font-weight: 800; color: var(--primary); text-decoration: none; }
    nav a { padding: 0.6rem 1.2rem; border-radius: 10px; text-decoration: none; font-weight: 600; color: #4a5568; transition: 0.3s; font-size: 0.9rem; }
    nav a:hover { color: var(--primary); background: #f1f5f9; }
    nav a.active { background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; }

    /* Layout */
    .container { max-width: 1200px; margin: 0 auto; padding: 3rem 2rem; }
    .page-header { text-align: center; margin-bottom: 4rem; color: white; }
    .page-header h1 { font-size: 3.5rem; font-weight: 800; letter-spacing: -1px; margin-bottom: 0.5rem; }
    
    /* Employee Card */
    .employee-card { 
      background: var(--glass); 
      border-radius: 30px; 
      padding: 3rem; 
      margin-bottom: 3rem; 
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
      border: 1px solid rgba(255,255,255,0.3);
    }

    .employee-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 2.5rem; }
    .profile-section { display: flex; gap: 1.5rem; align-items: center; }
    .avatar { width: 90px; height: 90px; border-radius: 24px; background: linear-gradient(135deg, var(--primary), var(--secondary)); display: flex; align-items: center; justify-content: center; color: white; font-size: 2.2rem; font-weight: 800; }
    
    .score-circle { 
      background: linear-gradient(135deg, var(--primary), var(--secondary)); 
      color: white; 
      width: 110px; height: 110px; 
      border-radius: 50%; 
      display: flex; flex-direction: column; 
      align-items: center; justify-content: center; 
      box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
    }
    .score-number { font-size: 2.5rem; font-weight: 800; line-height: 1; }
    .score-label { font-size: 0.7rem; text-transform: uppercase; font-weight: 700; opacity: 0.9; }

    /* Content Grid */
    .content-grid { display: grid; grid-template-columns: 1fr 1.2fr; gap: 3rem; }
    .metrics-list { list-style: none; background: #f8fafc; padding: 1.5rem; border-radius: 20px; }
    .metric-row { display: flex; justify-content: space-between; padding: 1rem 0; border-bottom: 1px solid #e2e8f0; }
    .metric-row:last-child { border: none; }
    .metric-name { font-weight: 600; color: #64748b; }
    .metric-val { font-weight: 700; color: var(--text-dark); }

    /* AI Insights - Premium Styling */
    .ai-box { 
      background: #fffbeb; 
      border: 1px solid #fde68a; 
      border-radius: 20px; 
      padding: 2rem; 
      margin-top: 2rem; 
      position: relative;
      overflow: hidden;
    }
    .ai-box::before {
      content: ''; position: absolute; top: 0; left: -100%; width: 50%; height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
      animation: shimmer 3s infinite;
    }
    @keyframes shimmer { 100% { left: 200%; } }
    
    .ai-title { color: #92400e; font-weight: 800; display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem; text-transform: uppercase; font-size: 0.85rem; letter-spacing: 1px; }
    .ai-content { color: #78350f; font-size: 1.05rem; font-weight: 500; }

    @media (max-width: 900px) { .content-grid { grid-template-columns: 1fr; } }
    
    /* Utility */
    .print-btn { background: white; border: none; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer; font-weight: 600; transition: 0.3s; margin-top: 1rem; }
    .print-btn:hover { background: #edf2f7; }
  </style>
</head>

<body>
  <header>
    <div class="header-content">
      <a href="/" class="logo"><i class="fas fa-brain"></i><span>PerfTrack AI</span></a>
      <nav>
        <a href="/">Dashboard</a>
        <a href="/add_employee">Add Talent</a>
        <a href="/evaluate">Evaluate</a>
        <a href="/report" class="active">Intelligence Reports</a>
      </nav>
    </div>
  </header>

  <div class="container">
    <div class="page-header">
      <h1>Performance Intelligence</h1>
      <p>Data-driven insights for organizational excellence</p>
    </div>

    {% if employees %}
    <div class="employee-grid">
      {% for emp in employees %}
      <div class="employee-card">
        <div class="employee-header">
          <div class="profile-section">
            <div class="avatar">{{ emp.name[0].upper() }}</div>
            <div>
              <h2 style="font-size: 2rem; font-weight: 800;">{{ emp.name }}</h2>
              <p style="color: #64748b; font-weight: 600;">{{ emp.department }} | Employee ID: #{{ emp.id }}</p>
              
              {% set score = emp.predicted_score %}
              <div style="margin-top: 0.8rem;">
                {% if score >= 8.5 %}
                  <span style="background:#dcfce7; color:#166534; padding: 6px 16px; border-radius: 50px; font-weight: 700; font-size: 0.8rem;">
                    <i class="fas fa-crown"></i> ELITE TALENT
                  </span>
                {% elif score >= 7.0 %}
                  <span style="background:#dbeafe; color:#1e40af; padding: 6px 16px; border-radius: 50px; font-weight: 700; font-size: 0.8rem;">
                    <i class="fas fa-star"></i> HIGH PERFORMER
                  </span>
                {% else %}
                  <span style="background:#fee2e2; color:#991b1b; padding: 6px 16px; border-radius: 50px; font-weight: 700; font-size: 0.8rem;">
                    <i class="fas fa-chart-line"></i> GROWTH PHASE
                  </span>
                {% endif %}
              </div>
            </div>
          </div>
          <div class="score-circle">
            <span class="score-number">{{ "%.1f"|format(emp.predicted_score) }}</span>
            <span class="score-label">Global Score</span>
          </div>
        </div>

        <div class="content-grid">
          <div class="metrics-column">
            <div class="metrics-list">
              <div class="metric-row"><span class="metric-name">Attendance</span><span class="metric-val">{{ "%.1f"|format(emp.attendance) }}/10</span></div>
              <div class="metric-row"><span class="metric-name">Task Efficiency</span><span class="metric-val">{{ "%.1f"|format(emp.task_efficiency) }}/10</span></div>
              <div class="metric-row"><span class="metric-name">Teamwork</span><span class="metric-val">{{ "%.1f"|format(emp.teamwork) }}/10</span></div>
              <div class="metric-row"><span class="metric-name">Initiative</span><span class="metric-val">{{ "%.1f"|format(emp.initiative) }}/10</span></div>
              <div class="metric-row"><span class="metric-name">Project Quality</span><span class="metric-val">{{ "%.1f"|format(emp.project_quality) }}/10</span></div>
            </div>
            
            <button class="print-btn" onclick="window.print()">
              <i class="fas fa-file-pdf"></i> Export Intelligence Report
            </button>
          </div>

          <div class="chart-box">
            <canvas id="radar-{{ emp.id }}" height="280"></canvas>
          </div>
        </div>

        <div class="ai-box">
          <div class="ai-title"><i class="fas fa-bolt"></i> AI Core Analysis</div>
          <div class="ai-content">
            {{ emp.ai_insight }}
          </div>
        </div>
      </div>

      <script>
        (function() {
          const ctx = document.getElementById('radar-{{ emp.id }}').getContext('2d');
          new Chart(ctx, {
            type: 'radar',
            data: {
              labels: ['Attendance', 'Efficiency', 'Teamwork', 'Initiative', 'Quality'],
              datasets: [{
                label: 'Competency Map',
                data: [{{ emp.attendance }}, {{ emp.task_efficiency }}, {{ emp.teamwork }}, {{ emp.initiative }}, {{ emp.project_quality }}],
                backgroundColor: 'rgba(102, 126, 234, 0.2)',
                borderColor: '#667eea',
                borderWidth: 3,
                pointBackgroundColor: '#764ba2',
                pointRadius: 4
              }]
            },
            options: {
              scales: {
                r: {
                  beginAtZero: true,
                  max: 10,
                  ticks: { display: false },
                  grid: { color: '#e2e8f0' }
                }
              },
              plugins: { legend: { display: false } }
            }
          });
        })();
      </script>
      {% endfor %}
    </div>
    {% else %}
    <div style="text-align: center; color: white; padding: 5rem;">
      <i class="fas fa-database fa-4x" style="margin-bottom: 2rem; opacity: 0.5;"></i>
      <h2>Engine Idle: No Data Found</h2>
      <p>Add employees to generate AI performance matrices.</p>
    </div>
    {% endif %}
  </div>

  <footer style="padding: 3rem; text-align: center; color: rgba(255,255,255,0.7); font-size: 0.9rem;">
    &copy; 2025 PerfTrack AI | Powered by Gemini 2.5 Intelligence Engine
  </footer>
</body>
</html>